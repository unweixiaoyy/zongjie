面试题

###### 性能优化

* 页面渲染卡顿优化

* 稳定、不闪退

> 卡顿优化用到的工具（开发者选项）

* MAT工具
* View Inspector
* View Inspector
* Analyze APK
* monitor 
* Lint
* GPU过度绘制区域
```java
原色，一般是白色，无绘制；紫色，1层；绿色，2层；粉色，3层；红色，4层。
```
* GPU渲染分析
```java
开启后，柱形图显示每一帧渲染时间，横线部分是16ms标记线，在这个线下面都是流程的，超过这个线过多代表绘制卡顿。

```
* 严格模式
```java
1.主线程中不能有：a.硬盘的读写操作，b.联网操作，c.运行速度慢的操作(目前发现只在WebView中有这个检查操作)。
2.针对虚拟机：a.检查数据库的操作有没有关闭 b.检查一些需要close的资源有没有close c.检查有没有Activity泄漏
    d.检查一些注册了的资源有没有取消注册。 e.检查实例的数量 f.检查uri的抬头
```
* 卡顿优化
```java
UI的过度绘制；
数据上的问题：1:UI线程做了耗时操作；2:子线程处理任务比较繁重，导致主线程拿不到Cpu时间片；3:GC频率增加，卡顿明显；
绘制的问题。
解决：
不在UI线程做耗时操作；
减少UI布局层次减少嵌套。使用Hierarchy Viewer分析View结构;
使用merge减少布局层次，viewStub布局按需加载；
RelativeLayout和LinerLayout取舍，LinerLayout权重少用。
避免多度绘制，绘制多余的背景；
刷新频率，如进度回调，刷新区域，如更新RV指定Item。
```

* 内存问题
```java
内存泄漏
使用Leak Canary，或者使用MAT分析。
非静态内部类持有外部引用，导致外部类无法被正常回收。如Handler，应该设置为静态内部类，或者在Activity销毁时移除消息。
Application Context和Activity Context。
静态变量引用Activity Context，或者静态View，也会持有Activity Context。
在Application的onLowMemory回收资源。

内存抖动等
使用Monitor看内存情况
```

* 胡凯博客
http://hukai.me/android-performance-patterns/

http://hukai.me/android-performance-render/

http://hukai.me/android-performance-compute/

4:http://hukai.me/android-performance-memory/

5:http://hukai.me/android-performance-battery/

6:http://hukai.me/android-performance-patterns-season-2/
7:http://hukai.me/android-performance-patterns-season-3/
8:http://hukai.me/android-performance-patterns-season-4/
9:http://hukai.me/android-performance-patterns-season-5/
10:http://hukai.me/android-performance-patterns-season-6/
11:http://hukai.me/android-performance-oom/

* 我使用过的内存优化
```java
减少布局层次，使用View inspector，或者自己分析，主要是修改RelativeLayout和LinerLayout、merge和ViewStub、去掉View不合理的背景，使用GPU过度绘制区域。
使用Lint分析项目，选择performance，工具会给一些需要优化的提示。如没有提到的，HashMap被替换成SparseMap、

避免使用枚举，改为注解@intRef和@StringDef 
```